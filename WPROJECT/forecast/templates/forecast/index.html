<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Intel | Atmospheric Analysis Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --border: rgba(255, 255, 255, 0.15); --blue: #38bdf8; }
        body { background: radial-gradient(circle at top left, #1e3c72, #0f172a); color: white; font-family: 'Segoe UI', sans-serif; min-height: 100vh; margin: 0; overflow-x: hidden; }
        #particles-js { position: fixed; width: 100%; height: 100%; z-index: -1; top: 0; left: 0; }
        
        /* HOVER EFFECT ON CARDS */
        .glass-card  {
            background: var(--glass); backdrop-filter: blur(25px); border: 1px solid var(--border); 
            border-radius: 35px; transition: all 0.4s ease-out; 
        }
        .glass-card:hover { transform: translateY(-10px); border-color: rgba(56, 189, 248, 0.4); box-shadow: 0 15px 40px rgba(0,0,0,0.3); }

        /* LANDING PAGE (PORTAL VIEW) - MATCHING IMAGE image_a9339e.jpg */
        .portal-container { height: 95vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .portal-title { font-size: 5.5rem; font-weight: 800; letter-spacing: -2px; margin-bottom: 0; }
        .portal-subtitle { font-size: 1.2rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 2px; margin-top: -10px; margin-bottom: 40px; }
        .portal-input { 
            background: #f8fafc; border: none; border-radius: 12px; padding: 22px; 
            width: 100%; max-width: 450px; color: #1e293b; font-size: 1.1rem; text-align: center; transition: 0.3s;
        }
        .portal-input:focus { transform: scale(1.05); outline: none; box-shadow: 0 0 30px rgba(56, 189, 248, 0.3); }
        .portal-btn { background: #3b82f6; border: none; border-radius: 10px; padding: 15px 35px; font-weight: bold; margin-top: 25px; transition: 0.3s; color: white; }
        .portal-btn:hover { background: #2563eb; transform: scale(1.1); }

        /* DASHBOARD DESIGN */
        .hero-temp { font-size: 7rem; font-weight: 900; background: linear-gradient(to bottom, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .visual-wrapper { height: 120px; display: flex; align-items: center; justify-content: center; position: relative; }
        .sun-glow { width: 70px; height: 70px; background: #ffce54; border-radius: 50%; box-shadow: 0 0 40px #ff9f43; animation: pulse 3s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <div class="container py-4">
        {% if not current or current.error %}
        <div class="portal-container">
            <h1 class="portal-title">Weather <span style="color: var(--blue);">Intel</span></h1>
            <p class="portal-subtitle">Atmospheric Analysis Engine</p>
            
            <form method="POST" class="w-100 d-flex flex-column align-items-center">
                {% csrf_token %}
                <input type="text" name="city" class="portal-input shadow-lg" placeholder="Define Location..." required>
                <button class="portal-btn shadow" type="submit">Initialize Intel</button>
            </form>
            {% if current.error %}<div class="mt-4 glass-card p-3 border-0">{{ current.error }}</div>{% endif %}
        </div>
        {% endif %}

        {% if current.temp %}
        <div class="d-flex justify-content-between align-items-center mb-5 glass-card p-3 px-4 shadow-lg">
            <h2 class="fw-bold m-0">Weather <span style="color: var(--blue);">Intel</span></h2>
            <form method="POST" class="d-flex gap-2" style="max-width: 350px;">
                {% csrf_token %}
                <input type="text" name="city" class="form-control rounded-pill border-0 px-4" placeholder="Update Intel..." required>
                <button class="btn btn-info rounded-pill px-4 fw-bold text-white" type="submit">UPDATE</button>
            </form>
        </div>

        <div class="row g-4">
            <div class="col-lg-4">
                <div class="glass-card p-5 text-center h-100">
                    <h1 class="fw-bold display-4">{{ city|title }}</h1>
                    <div class="visual-wrapper my-4">
                        {% if "clear" in current.condition %}<div class="sun-glow"></div>
                        {% else %}<img src="http://openweathermap.org/img/wn/{{ current.icon }}@4x.png" style="width: 140px; filter: drop-shadow(0 0 10px white);">{% endif %}
                    </div>
                    <div class="hero-temp">{{ current.temp }}°</div>
                    <p class="text-uppercase opacity-50 tracking-widest">{{ current.desc }}</p>
                    <div class="row g-2 mt-4">
                        <div class="col-6"><div class="glass-card p-3 small">Humidity<br><strong>{{ current.hum }}%</strong></div></div>
                        <div class="col-6"><div class="glass-card p-3 small">Pressure<br><strong>{{ current.pres }}</strong></div></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="glass-card p-4 mb-4" style="min-height: 400px; display: flex; flex-direction: column;">
                    <h5 class="mb-4 opacity-75 fw-bold">Comparative Trend: Temperature vs Humidity</h5>
                    <div class="flex-grow-1" style="position: relative; width: 100%;">
                        <canvas id="compChart"></canvas>
                    </div>
                </div>
                <div class="glass-card p-4">
                    <div class="row g-2">
                        {% for day in forecast %}
                        <div class="col"><div class="text-center p-3 glass-card" style="background: rgba(255,255,255,0.03); border-radius: 20px;">
                            <small class="opacity-50">{{ day.day|slice:":3" }}</small>
                            <h6 class="fw-bold mt-2 mb-0">{{ day.temp }}°</h6>
                        </div></div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        particlesJS("particles-js", { "particles": { "number": { "value": 70 }, "color": { "value": "#ffffff" }, "opacity": { "value": 0.2 }, "size": { "value": 2 }, "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.1 }, "move": { "enable": true, "speed": 1 } } });

        {% if current.temp %}
        const ctx = document.getElementById('compChart').getContext('2d');
        const grad1 = ctx.createLinearGradient(0, 0, 0, 350);
        grad1.addColorStop(0, 'rgba(255, 206, 84, 0.3)'); grad1.addColorStop(1, 'rgba(255, 206, 84, 0)');
        const grad2 = ctx.createLinearGradient(0, 0, 0, 350);
        grad2.addColorStop(0, 'rgba(56, 189, 248, 0.3)'); grad2.addColorStop(1, 'rgba(56, 189, 248, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ chart_labels|safe }},
                datasets: [
                    { label: 'Temp (°C)', data: {{ chart_temps|safe }}, borderColor: '#ffce54', backgroundColor: grad1, fill: true, tension: 0.45, borderWidth: 4, pointRadius: 5, pointBackgroundColor: '#fff' },
                    { label: 'Humidity (%)', data: {{ chart_humidity|safe }}, borderColor: '#38bdf8', backgroundColor: grad2, fill: true, tension: 0.45, borderWidth: 4, pointRadius: 5, pointBackgroundColor: '#fff' }
                ]
            },
            options: { 
                responsive: true, maintainAspectRatio: false, 
                plugins: { legend: { labels: { color: 'white', font: { weight: 'bold' } } } },
                scales: { x: { display: false }, y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: 'rgba(255,255,255,0.5)' } } } 
            }
        });
        {% endif %}
    </script>
</body>
</html>